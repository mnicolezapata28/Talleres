# Taller Grupal 1: Programación Funcional Reactiva

**Semana:** 11  
**Asignatura:** Programación Funcional y Reactiva  

---

### Objetivos:
- Crear un `case class` en Scala para modelar datos específicos de un archivo CSV.
- Manipular colecciones de datos y realizar operaciones de filtrado y cálculos estadísticos.
- Aplicar fórmulas matemáticas (varianza) mediante el uso de funciones de agregación y procesamiento funcional.

> [!IMPORTANT]
> Resolver el siguiente problema en grupos según proyecto integrador (**solo estudiantes presentes en el aula**). El archivo a utilizar es: **`pi_movies_small.csv`**.

---

### Parte 1: Definición de case class y lectura de archivo

1. **Definición de la estructura:** Cree una `case class` llamada `Movie` que permita leer las siguientes columnas del archivo CSV: `adult`, `revenue`, `popularity`, `runtime` y `vote_average`.
2. **Tipado de datos:** Configure los atributos de la siguiente manera para asegurar un procesamiento correcto:
    - `adult`: `Boolean`
    - `revenue`: `Double`
    - `popularity`: `Double`
    - `runtime`: `Double`
    - `vote_average`: `Double`
3. **Implementación de lectura:** Utilizando la librería `fs2-data-csv` y el stack de `Cats Effect`, realice la lectura del archivo y convierta los datos en una lista de objetos de tipo `Movie`. Recuerde que el delimitador del archivo es punto y coma (`;`).

> **Entregable:** Código de la `case class` y el bloque de código funcional que realiza la lectura y carga de los datos.

---


### Parte 2: Análisis de datos

Utilizando la lista de objetos obtenida en la parte anterior, implemente la lógica para resolver los siguientes requerimientos:

1. **Filtrado por ingresos:** Obtenga y muestre una lista (o el conteo) de todas las películas cuyo `revenue` (ingresos) sea estrictamente mayor al promedio de ingresos de todo el conjunto de datos.
2. **Cálculo de la varianza:** Calcule la varianza de las calificaciones (`vote_average`) aplicando la siguiente fórmula:

$$
\sigma^2 = \frac{\sum_{i=1}^{n} (x_i - \overline{x})^2}{n}
$$

Donde:
- $x_i$: es el **vote_average** de cada película.
- $\overline{x}$: es el promedio de los **vote_average**.
- $n$: es el número total de películas procesadas.

> **Entregable:** Bloques de código donde se apliquen las funciones de orden superior (`filter`, `map`, `sum`) para resolver ambos puntos y capturas de pantalla de los resultados impresos en la consola.

---

```Scala
package TallerSemana11

import cats.effect.{IO, IOApp}
import fs2.text
import fs2.io.file.{Files, Path}
import fs2.data.csv.*
import fs2.data.csv.generic.semiauto.*

case class MoviesSmall(
                        adult: Boolean,
                        revenue: Double,
                        popularity: Double,
                        runtime: Double,
                        vote_average: Double
                      )

 given CsvRowDecoder[MoviesSmall, String] =
  deriveCsvRowDecoder[MoviesSmall]

 object Problema1:

 def promedio(datos: List[Double]): Double =
if datos.isEmpty then 0.0
 else datos.sum / conteo(datos)

def conteo[A](datos: List[A]): Int = datos.length

def varianza(datos: List[Double]): Double =
 if datos.isEmpty then 0.0
  else
      val avg = promedio(datos)
      val sumSquaredDiff = datos.map(x => math.pow(x - avg, 2)).sum
      sumSquaredDiff / conteo(datos)

object EstadisticasMovie extends IOApp.Simple:

 val filePath =
 Path("D:/ClaseO25F26/src/main/resources/data/pi_movies_small (3).csv")

  val run: IO[Unit] =
    Files[IO]
    .readAll(filePath)
      .through(text.utf8.decode)
      .through(decodeUsingHeaders[MoviesSmall](';'))
      .compile
      .toList
      .flatMap { movie =>

        val colRevenue = movie.map(_.revenue)
        val colVoteAverage = movie.map(_.vote_average)

        val promedioRevenue = Problema1.promedio(colRevenue)
        val filtradas = movie.filter(_.revenue > promedioRevenue)

        IO.println("=" * 55) >>
          IO.println("       ESTADÍSTICAS - PELÍCULAS") >>
          IO.println("=" * 55) >>
          IO.println(s"Total de películas: ${Problema1.conteo(movie)}") >>
          IO.println(f"Promedio Revenue: $promedioRevenue%.2f") >>
          IO.println(s"Películas con revenue > promedio: ${filtradas.length}") >>
          IO.println(f"Varianza VoteAverage: ${Problema1.varianza(colVoteAverage)}%.2f") >>
          IO.println("=" * 55)
      }


```



### ✅ Calificación:

Una vez que termine debe presentar su trabajo a su docente.

- **10 puntos:** si presenta en el horario de prácticas y experimentación.
- **7 puntos:** si presenta en el horario de tutoría.

**La hora máxima de presentación será las 08h30.**
